<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style type="text/css">
.highlight { background-color: rgb(255, 255, 204); }
pre { display: inline; }
div.calls { display: inline; }
span.method_definition { font-weight: bold; }
span.method_call { font-weight: bold; }
div.line a { font-size: 12px; }
</style>
</head>
<body>
<div class='line' id='1'><pre>  1: </pre><pre>class Module</pre></div>
<div class='line' id='2'><pre>  2: </pre><pre>  # Provides a delegate class method to easily expose contained objects' methods</pre></div>
<div class='line' id='3'><pre>  3: </pre><pre>  # as your own. Pass one or more methods (specified as symbols or strings)</pre></div>
<div class='line' id='4'><pre>  4: </pre><pre>  # and the name of the target object via the <tt>:to</tt> option (also a symbol</pre></div>
<div class='line' id='5'><pre>  5: </pre><pre>  # or string). At least one method and the <tt>:to</tt> option are required.</pre></div>
<div class='line' id='6'><pre>  6: </pre><pre>  #</pre></div>
<div class='line' id='7'><pre>  7: </pre><pre>  # Delegation is particularly useful with Active Record associations:</pre></div>
<div class='line' id='8'><pre>  8: </pre><pre>  #</pre></div>
<div class='line' id='9'><pre>  9: </pre><pre>  #   class Greeter < ActiveRecord::Base</pre></div>
<div class='line' id='10'><pre> 10: </pre><pre>  #     def hello</pre></div>
<div class='line' id='11'><pre> 11: </pre><pre>  #       "hello"</pre></div>
<div class='line' id='12'><pre> 12: </pre><pre>  #     end</pre></div>
<div class='line' id='13'><pre> 13: </pre><pre>  #</pre></div>
<div class='line' id='14'><pre> 14: </pre><pre>  #     def goodbye</pre></div>
<div class='line' id='15'><pre> 15: </pre><pre>  #       "goodbye"</pre></div>
<div class='line' id='16'><pre> 16: </pre><pre>  #     end</pre></div>
<div class='line' id='17'><pre> 17: </pre><pre>  #   end</pre></div>
<div class='line' id='18'><pre> 18: </pre><pre>  #</pre></div>
<div class='line' id='19'><pre> 19: </pre><pre>  #   class Foo < ActiveRecord::Base</pre></div>
<div class='line' id='20'><pre> 20: </pre><pre>  #     belongs_to :greeter</pre></div>
<div class='line' id='21'><pre> 21: </pre><pre>  #     delegate :hello, :to => :greeter</pre></div>
<div class='line' id='22'><pre> 22: </pre><pre>  #   end</pre></div>
<div class='line' id='23'><pre> 23: </pre><pre>  #</pre></div>
<div class='line' id='24'><pre> 24: </pre><pre>  #   Foo.new.hello   # => "hello"</pre></div>
<div class='line' id='25'><pre> 25: </pre><pre>  #   Foo.new.goodbye # => NoMethodError: undefined method `goodbye' for #<Foo:0x1af30c></pre></div>
<div class='line' id='26'><pre> 26: </pre><pre>  #</pre></div>
<div class='line' id='27'><pre> 27: </pre><pre>  # Multiple delegates to the same target are allowed:</pre></div>
<div class='line' id='28'><pre> 28: </pre><pre>  #</pre></div>
<div class='line' id='29'><pre> 29: </pre><pre>  #   class Foo < ActiveRecord::Base</pre></div>
<div class='line' id='30'><pre> 30: </pre><pre>  #     belongs_to :greeter</pre></div>
<div class='line' id='31'><pre> 31: </pre><pre>  #     delegate :hello, :goodbye, :to => :greeter</pre></div>
<div class='line' id='32'><pre> 32: </pre><pre>  #   end</pre></div>
<div class='line' id='33'><pre> 33: </pre><pre>  #</pre></div>
<div class='line' id='34'><pre> 34: </pre><pre>  #   Foo.new.goodbye # => "goodbye"</pre></div>
<div class='line' id='35'><pre> 35: </pre><pre>  #</pre></div>
<div class='line' id='36'><pre> 36: </pre><pre>  # Methods can be delegated to instance variables, class variables, or constants</pre></div>
<div class='line' id='37'><pre> 37: </pre><pre>  # by providing them as a symbols:</pre></div>
<div class='line' id='38'><pre> 38: </pre><pre>  #</pre></div>
<div class='line' id='39'><pre> 39: </pre><pre>  #   class Foo</pre></div>
<div class='line' id='40'><pre> 40: </pre><pre>  #     CONSTANT_ARRAY = [0,1,2,3]</pre></div>
<div class='line' id='41'><pre> 41: </pre><pre>  #     @@class_array  = [4,5,6,7]</pre></div>
<div class='line' id='42'><pre> 42: </pre><pre>  #</pre></div>
<div class='line' id='43'><pre> 43: </pre><pre>  #     def initialize</pre></div>
<div class='line' id='44'><pre> 44: </pre><pre>  #       @instance_array = [8,9,10,11]</pre></div>
<div class='line' id='45'><pre> 45: </pre><pre>  #     end</pre></div>
<div class='line' id='46'><pre> 46: </pre><pre>  #     delegate :sum, :to => :CONSTANT_ARRAY</pre></div>
<div class='line' id='47'><pre> 47: </pre><pre>  #     delegate :min, :to => :@@class_array</pre></div>
<div class='line' id='48'><pre> 48: </pre><pre>  #     delegate :max, :to => :@instance_array</pre></div>
<div class='line' id='49'><pre> 49: </pre><pre>  #   end</pre></div>
<div class='line' id='50'><pre> 50: </pre><pre>  #</pre></div>
<div class='line' id='51'><pre> 51: </pre><pre>  #   Foo.new.sum # => 6</pre></div>
<div class='line' id='52'><pre> 52: </pre><pre>  #   Foo.new.min # => 4</pre></div>
<div class='line' id='53'><pre> 53: </pre><pre>  #   Foo.new.max # => 11</pre></div>
<div class='line' id='54'><pre> 54: </pre><pre>  #</pre></div>
<div class='line' id='55'><pre> 55: </pre><pre>  # Delegates can optionally be prefixed using the <tt>:prefix</tt> option. If the value</pre></div>
<div class='line' id='56'><pre> 56: </pre><pre>  # is <tt>true</tt>, the delegate methods are prefixed with the name of the object being</pre></div>
<div class='line' id='57'><pre> 57: </pre><pre>  # delegated to.</pre></div>
<div class='line' id='58'><pre> 58: </pre><pre>  #</pre></div>
<div class='line' id='59'><pre> 59: </pre><pre>  #   Person = Struct.new(:name, :address)</pre></div>
<div class='line' id='60'><pre> 60: </pre><pre>  #</pre></div>
<div class='line' id='61'><pre> 61: </pre><pre>  #   class Invoice < Struct.new(:client)</pre></div>
<div class='line' id='62'><pre> 62: </pre><pre>  #     delegate :name, :address, :to => :client, :prefix => true</pre></div>
<div class='line' id='63'><pre> 63: </pre><pre>  #   end</pre></div>
<div class='line' id='64'><pre> 64: </pre><pre>  #</pre></div>
<div class='line' id='65'><pre> 65: </pre><pre>  #   john_doe = Person.new("John Doe", "Vimmersvej 13")</pre></div>
<div class='line' id='66'><pre> 66: </pre><pre>  #   invoice = Invoice.new(john_doe)</pre></div>
<div class='line' id='67'><pre> 67: </pre><pre>  #   invoice.client_name    # => "John Doe"</pre></div>
<div class='line' id='68'><pre> 68: </pre><pre>  #   invoice.client_address # => "Vimmersvej 13"</pre></div>
<div class='line' id='69'><pre> 69: </pre><pre>  #</pre></div>
<div class='line' id='70'><pre> 70: </pre><pre>  # It is also possible to supply a custom prefix.</pre></div>
<div class='line' id='71'><pre> 71: </pre><pre>  #</pre></div>
<div class='line' id='72'><pre> 72: </pre><pre>  #   class Invoice < Struct.new(:client)</pre></div>
<div class='line' id='73'><pre> 73: </pre><pre>  #     delegate :name, :address, :to => :client, :prefix => :customer</pre></div>
<div class='line' id='74'><pre> 74: </pre><pre>  #   end</pre></div>
<div class='line' id='75'><pre> 75: </pre><pre>  #</pre></div>
<div class='line' id='76'><pre> 76: </pre><pre>  #   invoice = Invoice.new(john_doe)</pre></div>
<div class='line' id='77'><pre> 77: </pre><pre>  #   invoice.customer_name    # => "John Doe"</pre></div>
<div class='line' id='78'><pre> 78: </pre><pre>  #   invoice.customer_address # => "Vimmersvej 13"</pre></div>
<div class='line' id='79'><pre> 79: </pre><pre>  #</pre></div>
<div class='line' id='80'><pre> 80: </pre><pre>  # If the delegate object is +nil+ an exception is raised, and that happens</pre></div>
<div class='line' id='81'><pre> 81: </pre><pre>  # no matter whether +nil+ responds to the delegated method. You can get a</pre></div>
<div class='line' id='82'><pre> 82: </pre><pre>  # +nil+ instead with the +:allow_nil+ option.</pre></div>
<div class='line' id='83'><pre> 83: </pre><pre>  #</pre></div>
<div class='line' id='84'><pre> 84: </pre><pre>  #  class Foo</pre></div>
<div class='line' id='85'><pre> 85: </pre><pre>  #    attr_accessor :bar</pre></div>
<div class='line' id='86'><pre> 86: </pre><pre>  #    def initialize(bar = nil)</pre></div>
<div class='line' id='87'><pre> 87: </pre><pre>  #      @bar = bar</pre></div>
<div class='line' id='88'><pre> 88: </pre><pre>  #    end</pre></div>
<div class='line' id='89'><pre> 89: </pre><pre>  #    delegate :zoo, :to => :bar</pre></div>
<div class='line' id='90'><pre> 90: </pre><pre>  #  end</pre></div>
<div class='line' id='91'><pre> 91: </pre><pre>  #</pre></div>
<div class='line' id='92'><pre> 92: </pre><pre>  #  Foo.new.zoo   # raises NoMethodError exception (you called nil.zoo)</pre></div>
<div class='line' id='93'><pre> 93: </pre><pre>  #</pre></div>
<div class='line' id='94'><pre> 94: </pre><pre>  #  class Foo</pre></div>
<div class='line' id='95'><pre> 95: </pre><pre>  #    attr_accessor :bar</pre></div>
<div class='line' id='96'><pre> 96: </pre><pre>  #    def initialize(bar = nil)</pre></div>
<div class='line' id='97'><pre> 97: </pre><pre>  #      @bar = bar</pre></div>
<div class='line' id='98'><pre> 98: </pre><pre>  #    end</pre></div>
<div class='line' id='99'><pre> 99: </pre><pre>  #    delegate :zoo, :to => :bar, :allow_nil => true</pre></div>
<div class='line' id='100'><pre>100: </pre><pre>  #  end</pre></div>
<div class='line' id='101'><pre>101: </pre><pre>  #</pre></div>
<div class='line' id='102'><pre>102: </pre><pre>  #  Foo.new.zoo   # returns nil</pre></div>
<div class='line' id='103'><pre>103: </pre><pre>  #</pre></div>
<div class='line' id='104'><pre>104: </pre><div class='calls'><span class='method_definition'><pre>  def delegate(*methods)</pre></span> <span style='display:none;'><a href='../../xml_mini.rb.html#80'>/Users/eloy/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/activesupport-3.2.14/lib/active_support/xml_mini.rb:80</a></span></div></div>
<div class='line' id='105'><pre>105: </pre><pre>    options = methods.pop</pre></div>
<div class='line' id='106'><pre>106: </pre><pre>    unless options.is_a?(Hash) && to = options[:to]</pre></div>
<div class='line' id='107'><pre>107: </pre><pre>      raise ArgumentError, "Delegation needs a target. Supply an options hash with a :to key as the last argument (e.g. delegate :hello, :to => :greeter)."</pre></div>
<div class='line' id='108'><pre>108: </pre><pre>    end</pre></div>
<div class='line' id='109'><pre>109: </pre><pre>    prefix, to, allow_nil = options[:prefix], options[:to], options[:allow_nil]</pre></div>
<div class='line' id='110'><pre>110: </pre><pre></pre></div>
<div class='line' id='111'><pre>111: </pre><pre>    if prefix == true && to.to_s =~ /^[^a-z_]/</pre></div>
<div class='line' id='112'><pre>112: </pre><pre>      raise ArgumentError, "Can only automatically set the delegation prefix when delegating to a method."</pre></div>
<div class='line' id='113'><pre>113: </pre><pre>    end</pre></div>
<div class='line' id='114'><pre>114: </pre><pre></pre></div>
<div class='line' id='115'><pre>115: </pre><pre>    method_prefix =</pre></div>
<div class='line' id='116'><pre>116: </pre><pre>      if prefix</pre></div>
<div class='line' id='117'><pre>117: </pre><pre>        "#{prefix == true ? to : prefix}_"</pre></div>
<div class='line' id='118'><pre>118: </pre><pre>      else</pre></div>
<div class='line' id='119'><pre>119: </pre><pre>        ''</pre></div>
<div class='line' id='120'><pre>120: </pre><pre>      end</pre></div>
<div class='line' id='121'><pre>121: </pre><pre></pre></div>
<div class='line' id='122'><pre>122: </pre><pre>    file, line = caller.first.split(':', 2)</pre></div>
<div class='line' id='123'><pre>123: </pre><pre>    line = line.to_i</pre></div>
<div class='line' id='124'><pre>124: </pre><pre></pre></div>
<div class='line' id='125'><pre>125: </pre><pre>    methods.each do |method|</pre></div>
<div class='line' id='126'><pre>126: </pre><pre>      method = method.to_s</pre></div>
<div class='line' id='127'><pre>127: </pre><pre></pre></div>
<div class='line' id='128'><pre>128: </pre><pre>      if allow_nil</pre></div>
<div class='line' id='129'><pre>129: </pre><pre>        module_eval(<<-EOS, file, line - 2)</pre></div>
<div class='line' id='130'><pre>130: </pre><pre>          def #{method_prefix}#{method}(*args, &block)        # def customer_name(*args, &block)</pre></div>
<div class='line' id='131'><pre>131: </pre><pre>            if #{to} || #{to}.respond_to?(:#{method})         #   if client || client.respond_to?(:name)</pre></div>
<div class='line' id='132'><pre>132: </pre><pre>              #{to}.__send__(:#{method}, *args, &block)       #     client.__send__(:name, *args, &block)</pre></div>
<div class='line' id='133'><pre>133: </pre><pre>            end                                               #   end</pre></div>
<div class='line' id='134'><pre>134: </pre><pre>          end                                                 # end</pre></div>
<div class='line' id='135'><pre>135: </pre><pre>        EOS</pre></div>
<div class='line' id='136'><pre>136: </pre><pre>      else</pre></div>
<div class='line' id='137'><pre>137: </pre><pre>        exception = %(raise "#{self}##{method_prefix}#{method} delegated to #{to}.#{method}, but #{to} is nil: \#{self.inspect}")</pre></div>
<div class='line' id='138'><pre>138: </pre><pre></pre></div>
<div class='line' id='139'><pre>139: </pre><pre>        module_eval(<<-EOS, file, line - 1)</pre></div>
<div class='line' id='140'><pre>140: </pre><pre>          def #{method_prefix}#{method}(*args, &block)        # def customer_name(*args, &block)</pre></div>
<div class='line' id='141'><pre>141: </pre><pre>            #{to}.__send__(:#{method}, *args, &block)         #   client.__send__(:name, *args, &block)</pre></div>
<div class='line' id='142'><pre>142: </pre><pre>          rescue NoMethodError                                # rescue NoMethodError</pre></div>
<div class='line' id='143'><pre>143: </pre><pre>            if #{to}.nil?                                     #   if client.nil?</pre></div>
<div class='line' id='144'><pre>144: </pre><pre>              #{exception}                                    #     # add helpful message to the exception</pre></div>
<div class='line' id='145'><pre>145: </pre><pre>            else                                              #   else</pre></div>
<div class='line' id='146'><pre>146: </pre><pre>              raise                                           #     raise</pre></div>
<div class='line' id='147'><pre>147: </pre><pre>            end                                               #   end</pre></div>
<div class='line' id='148'><pre>148: </pre><pre>          end                                                 # end</pre></div>
<div class='line' id='149'><pre>149: </pre><pre>        EOS</pre></div>
<div class='line' id='150'><pre>150: </pre><pre>      end</pre></div>
<div class='line' id='151'><pre>151: </pre><pre>    end</pre></div>
<div class='line' id='152'><pre>152: </pre><pre>  end</pre></div>
<div class='line' id='153'><pre>153: </pre><pre>end</pre></div>
<script src='../../../../../../../../../../../../../../../zepto.js'></script>
<script>
  var update_highlight = function() {
    $('div.highlight').removeClass('highlight');
    var hash = window.location.hash;
    if (hash.length > 0) $(hash).addClass('highlight');
  };
  $(window).on('hashchange', update_highlight);
  update_highlight();

  $(window).on('mouseenter', 'div.calls', function() {
    $(this).children().last().show();
  });
  $(window).on('mouseleave', 'div.calls', function() {
    $(this).children().last().hide();
  });
</script>
</body>
</html>
